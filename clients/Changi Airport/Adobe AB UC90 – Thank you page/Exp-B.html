<style>
    .notify-bubble {
        padding: 0.1rem;
        margin: 0.1rem;
        background-color: black;
        color: white;
        font-size: 12px;
        width: 3.5rem;
        border: 1px solid grey;
        border-radius: 10%;
        display: none;
        position: absolute;
        z-index: 1;
        text-align: center;
    }

    .promo-box {
        display: block;
        width: 60% !important;
        margin: 25px auto;
    }

    .promo-box-mob {
        display: block;
        width: 100%;
        margin: 25px auto;
    }

    .promo-box-mob:hover,
    .promo-box:hover {
        opacity: 0.8;
        cursor: pointer;
    }

    .skinny-banner-div {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background-color: #FFB033;
        color: #fff;
        text-align: center;
        padding: 0.5rem 1rem;
    }

    .skinny-banner-div:hover {
        cursor: pointer;
        opacity: 0.8;
    }

    .banner-text-top {
        font-size: 1.65rem;
    }

    .banner-text-bottom {
        font-size: 0.9rem;
    }

    .promocode-font {
        color: #8941B0;
        font-weight: 600;
        font-size: 1.65rem;
    }

    @media screen and (max-width: 480px) {
        .banner-text-top {
            font-size: 1.2rem;
            line-height: 1.1;
        }

        .banner-text-bottom {
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }

        .promocode-font {
            color: #8941B0;
            font-weight: 600;
            font-size: 1.2rem;
        }
    }
</style>

<script>
    (function () {
        try {
            // if condition qualifies activity for the order confirmation page
            if ((window.location.href).includes("en/order-confirmation") || window.digitalData.targetVars.pageView === "Order Confirmation Page View") {
                let counter = 0;
                let element_1 = document.querySelector("div.child-component-container > div:nth-child(3) > div.aem-page.root > div > div > div:nth-child(3) > div > div:nth-child(1) > div > div > div > p:nth-child(5)");

                function hideBubble() {
                    document.querySelector(".notify-bubble").style.display = "none";
                }

                let waitForElement = function () {
                    if (element_1 != null) {
                        let promoBanner_1 = "";
                        if (window.screen.availWidth >= 768) {
                            promoBanner_1 = `<span class="promo-box"><span class="notify-bubble">Copied!</span><img id="adb-promo-ocp" src="https://changiairport.scene7.com/is/content/changiairport/en_d_1280x720_2304_repurchase_NTR_subhero_checkout_promo" alt="SPECIAL10 promo" /></span>`;
                        } else {
                            promoBanner_1 = `<span class="promo-box-mob"><span class="notify-bubble">Copied!</span><img id="adb-promo-ocp" src="https://changiairport.scene7.com/is/content/changiairport/en_d_670x446_2304_repurchase_NTR_subhero_checkout_promo" alt="SPECIAL10 promo" /></span>`;
                        }
                        element_1.insertAdjacentHTML("afterend", promoBanner_1);

                        let clickBanner = document.querySelector("#adb-promo-ocp");
                        clickBanner.addEventListener('click', function () {
                            let name = 'en_d_1280x720_2304_repurchase_subhero_checkout_promo_exp_B';
                            if (window.s_gi) {
                                var s = s_gi('changairport-prod-new');
                                s.linkTrackVars = "eVar126";
                                s.eVar126 = name;
                                s.tl(true, "o", name);
                            }
                            navigator.clipboard.writeText("SPECIAL10");
                            document.querySelector(".notify-bubble").style.display = "block";
                            adobe.target.trackEvent({
                                "mbox": "orderConfirmPage",
                                "params": {
                                    "clicked": "clicked_repurchase_voucher_checkout_page"
                                }
                            });
                            setTimeout(() => {
                                hideBubble();
                                window.location = "https://www.ishopchangi.com/en/home";
                            }, 1000)
                        })

                    } else {
                        ++counter;
                        counter < 100 && setTimeout(function () { waitForElement(); }, 100);
                    }
                }
                waitForElement();
            }
            else {

                let counter = 0;
                let element_2 = document.querySelector("#header-searchbar-container > div.fixed-header-container");
                let skinnyBanner = document.querySelector("#adb-promo-sitewide");

                function hideBubble() {
                    document.querySelector(".notify-bubble").style.display = "none";
                }

                let waitForElement2 = function () {
                    if (element_2 != null && skinnyBanner === null) {
                        let promoBanner = `<div id="adb-promo-sitewide" class="skinny-banner-div"><span class="notify-bubble">Copied!</span><label class="banner-text-top">Apply your code <span class="promocode-font">SPECIAL10</span> to enjoy 10% OFF*!</label><label class="banner-text-bottom">Tap to copy code. Expires X Mar. Discount Cap S$20. T&Cs ap</label></div>`;
                        element_2.insertAdjacentHTML("beforeBegin", promoBanner);

                        let clickBanner = document.querySelector("#adb-promo-sitewide");
                        clickBanner.addEventListener('click', function () {
                            let name = 'en_repurchase_sitewide_banner_promo_exp_B';
                            if (window.s_gi) {
                                var s = s_gi('changairport-prod-new');
                                s.linkTrackVars = "eVar126";
                                s.eVar126 = name;
                                s.tl(true, "o", name);
                            }
                            navigator.clipboard.writeText("SPECIAL10");
                            document.querySelector(".notify-bubble").style.display = "block";
                            setTimeout(() => {
                                hideBubble();
                            }, 3000)
                        })

                    } else {
                        ++counter;
                        counter < 100 && setTimeout(function () { waitForElement2(); }, 100);
                    }
                }
                waitForElement2();
            }

        } catch (error) {
            console.log(error);
        }

    })();
</script>